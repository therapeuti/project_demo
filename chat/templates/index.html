<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Pet's Voice - 반려동물 등록</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid min-vh-100 d-flex align-items-center justify-content-center bg-gradient">
        <div class="card shadow-lg" style="max-width: 800px; width: 100%;">
            <div class="card-header text-center bg-primary text-white">
                <h2 class="mb-0"><i class="fas fa-paw me-2"></i>My Pet's Voice</h2>
                <p class="mb-0">반려동물의 정보를 입력하고 대화를 시작하세요</p>
            </div>
            <div class="card-body p-4">
                <form id="petForm">
                    <div class="row">
                        <!-- 기본 정보 -->
                        <div class="col-md-6 mb-3">
                            <label for="name" class="form-label"><i class="fas fa-tag text-primary me-1"></i>이름 *</label>
                            <input type="text" class="form-control" id="name" name="name" required>
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <label for="species" class="form-label"><i class="fas fa-cat text-primary me-1"></i>종류 *</label>
                            <select class="form-select" id="species" name="species" required>
                                <option value="">선택하세요</option>
                                {% for animal in animals_data.keys() %}
                                <option value="{{ animal }}">{{ animal }}</option>
                                {% endfor %}
                                <option value="기타">기타</option>
                            </select>
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <label for="breed" class="form-label"><i class="fas fa-dna text-primary me-1"></i>품종</label>
                            <select class="form-select" id="breed" name="breed">
                                <option value="">종류를 먼저 선택하세요</option>
                            </select>
                            <input type="text" class="form-control d-none" id="customBreed" name="customBreed" placeholder="직접 입력">
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <label for="age" class="form-label"><i class="fas fa-calendar text-primary me-1"></i>나이 *</label>
                            <input type="number" class="form-control" id="age" name="age" min="0" max="30" required>
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <label for="gender" class="form-label"><i class="fas fa-venus-mars text-primary me-1"></i>성별 *</label>
                            <select class="form-select" id="gender" name="gender" required>
                                <option value="">선택하세요</option>
                                <option value="남아">남아</option>
                                <option value="여아">여아</option>
                            </select>
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <label for="birthday" class="form-label"><i class="fas fa-birthday-cake text-primary me-1"></i>생일</label>
                            <input type="date" class="form-control" id="birthday" name="birthday">
                        </div>
                        
                        <div class="col-md-3 mb-3">
                            <label for="owner_call" class="form-label"><i class="fas fa-user text-primary me-1"></i>주인 호칭 *</label>
                            <input type="text" class="form-control" id="owner_call" name="owner_call" placeholder="예: 엄마, 아빠, 주인" required>
                        </div>
                    </div>
                    
                    <!-- 성격과 말투 -->
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><i class="fas fa-heart text-primary me-1"></i>성격 (여러 개 선택 가능)</label>
                            <div class="personality-tags">
                                {% for trait in personality_traits %}
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" name="personality" value="{{ trait }}" id="trait_{{ loop.index }}">
                                    <label class="form-check-label personality-tag" for="trait_{{ loop.index }}">
                                        {{ trait }}
                                    </label>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="speech_style" class="form-label"><i class="fas fa-comment text-primary me-1"></i>말투 *</label>
                            <select class="form-select" id="speech_style" name="speech_style" required>
                                <option value="">선택하세요</option>
                                {% for style in speech_styles %}
                                <option value="{{ style }}">{{ style }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <!-- 취향과 습관 -->
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="likes" class="form-label"><i class="fas fa-thumbs-up text-success me-1"></i>좋아하는 것</label>
                            <textarea class="form-control" id="likes" name="likes" rows="3" placeholder="쉼표로 구분해서 입력하세요. 예: 산책, 간식, 공놀이"></textarea>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label for="dislikes" class="form-label"><i class="fas fa-thumbs-down text-danger me-1"></i>싫어하는 것</label>
                            <textarea class="form-control" id="dislikes" name="dislikes" rows="3" placeholder="쉼표로 구분해서 입력하세요. 예: 목욕, 큰 소리, 낯선 사람"></textarea>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label for="habits" class="form-label"><i class="fas fa-sync text-warning me-1"></i>습관</label>
                            <textarea class="form-control" id="habits" name="habits" rows="3" placeholder="쉼표로 구분해서 입력하세요. 예: 꼬리 흔들기, 골골거리기"></textarea>
                        </div>
                    </div>
                    
                    <!-- 특이사항 -->
                    <div class="mb-4">
                        <label for="special_notes" class="form-label"><i class="fas fa-star text-warning me-1"></i>기타 특이사항</label>
                        <textarea class="form-control" id="special_notes" name="special_notes" rows="3" placeholder="외형, 가족관계, 특별한 에피소드 등 대화에 반영되었으면 하는 점을 자유롭게 작성하세요"></textarea>
                    </div>
                    
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-comments me-2"></i>대화 시작하기
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        // 동물 종류별 품종 데이터
        const animalsData = {{ animals_data | tojson }};
        
        // 종류 변경 시 품종 업데이트
        document.getElementById('species').addEventListener('change', function() {
            const species = this.value;
            const breedSelect = document.getElementById('breed');
            const customBreed = document.getElementById('customBreed');
            
            breedSelect.innerHTML = '<option value="">선택하세요</option>';
            
            if (species === '기타' || species === '') {
                if (species === '기타') {
                    breedSelect.classList.add('d-none');
                    customBreed.classList.remove('d-none');
                } else {
                    breedSelect.classList.remove('d-none');
                    customBreed.classList.add('d-none');
                }
                return;
            }
            
            breedSelect.classList.remove('d-none');
            customBreed.classList.add('d-none');
            
            if (animalsData[species]) {
                if (Array.isArray(animalsData[species])) {
                    animalsData[species].forEach(breed => {
                        const option = document.createElement('option');
                        option.value = breed;
                        option.textContent = breed;
                        breedSelect.appendChild(option);
                    });
                } else {
                    Object.values(animalsData[species]).flat().forEach(breed => {
                        const option = document.createElement('option');
                        option.value = breed;
                        option.textContent = breed;
                        breedSelect.appendChild(option);
                    });
                }
            }
        });
        
        // 폼 제출
        document.getElementById('petForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const customBreed = document.getElementById('customBreed').value;
            
            if (document.getElementById('species').value === '기타' && customBreed) {
                formData.set('breed', customBreed);
            }
            
            fetch('/create_pet', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.href = '/chat';
                } else {
                    alert('오류가 발생했습니다: ' + (data.error || '알 수 없는 오류'));
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('서버 오류가 발생했습니다.');
            });
        });
    </script>
</body>
</html>